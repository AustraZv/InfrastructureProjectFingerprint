(t=>{if(void 0!==t.MGModal)void 0===t.MG_Modal&&(t.MG_Modal=function(e){return new t.MGModal(e)});else{n.prototype.addEventListener=function(e,t){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t)},n.prototype.removeEventListener=function(e,t){this._listeners[e]&&-1!==(t=this._listeners[e].indexOf(t))&&this._listeners[e].splice(t,1)},n.prototype.dispatchEvent=function(e){var t=this._listeners[e.type];if(t)for(var n=0;n<t.length;n++)t[n].call(this,e);return!0};class c{constructor(e={}){this._privateData=new WeakMap,this._eventEmitter=new n,c._activeInstances||(c._activeInstances=new Set),this._activeInstances=c._activeInstances,this.options=this._validateOptions({...c._defaultOptions,...e}),this._privateData.set(this,{isOpen:!1,timer:null,elements:{},originalIds:new Map}),Object.defineProperty(this,"container",{get(){return this._privateData.get(this).elements.container}}),Object.defineProperty(this,"modal",{get(){return this._privateData.get(this).elements.modal}}),Object.defineProperty(this,"closeButton",{get(){return this._privateData.get(this).elements.closeButton}}),this._activeInstances.add(this),this.options.autoOpen&&this.openModal()}static get _config(){return this.__config||(this.__config={classes:{container:"containerMTubes",modal:"modalMTubes",content:"contentMTubes",fadeIn:"fadeInMTubes",fadeOut:"fadeOutMTubes",open:"isOpenMTubes",visible:"isVisibleMTubes",button:"buttonMTubes",close:"closeMTubes",scroll:"scrollMTubes",elementOpen:"elOpenMTubes"},ids:{container:"modalWrapMTubes"},prefixes:{modal:"MHP1138-"},animations:{fade:"fade"}}),this.__config}static get _defaultOptions(){return this.__defaults||(this.__defaults={autoOpen:!1,className:"generalMTubes",closeButton:!0,closeDocument:!0,closeKey:!1,content:"",maxWidth:"",minWidth:"",overlay:!0,position:"",pageScrolling:!1,timeMs:null,lazyload:!1,afterunload:null,flagCommentCancelClass:"flagCommentCancel",animation:"fade",focusTrap:!1,ariaLabel:"Modal window"}),this.__defaults}debug(){console.log("%cðŸ“Š MG_Modal Debug Info","color: #667eea; font-size: 16px; font-weight: bold;");var e=this._collectDebugInfo();return console.log("ðŸ“ˆ Statistics:",{total:e.total,version:"2.0.0",active:e.instances.filter(e=>e.instance.isOpen()).length}),console.log("ðŸ” Instances:"),e.instances.forEach((e,t)=>{var e=e.instance,n=e._privateData.get(e),n={element:this._makeClickableElement(n.elements.container),state:e.isOpen()?"open":"closed",options:{...e.options},hasTimer:!!n.timer,className:e.options.className,content:"string"==typeof e.options.content?"string":"DOM element"};console.log(`#${t+1}:`,n)}),e}inspect(e){var t=this._findInstanceByElement(e);if(!t)return console.warn("âŒ No MG_Modal instance found for element:",e),null;console.log("%cðŸ”Ž MG_Modal Instance Inspection","color: #764ba2; font-size: 14px; font-weight: bold;");e=t._privateData.get(t),t={element:this._makeClickableElement(e.elements.container),options:{...t.options},state:{isOpen:t.isOpen(),hasTimer:!!e.timer,eventListeners:e.elements.container?"active":"none"},elements:{container:this._makeClickableElement(e.elements.container),modal:this._makeClickableElement(e.elements.modal),contentHolder:this._makeClickableElement(e.elements.contentHolder),closeButton:e.elements.closeButton?this._makeClickableElement(e.elements.closeButton):"none"},config:c._config};return console.table(t),t}stats(){var e=this._collectDebugInfo(),e={totalInstances:e.total,openModals:e.instances.filter(e=>e.instance.isOpen()).length,closedModals:e.instances.filter(e=>!e.instance.isOpen()).length,memoryUsage:(15*e.total).toFixed(1)+"KB estimated",version:"2.0.0",config:c._config};return console.log("%cðŸ“ˆ MG_Modal Statistics","color: #f59e0b; font-size: 14px; font-weight: bold;"),console.table(e),e}getInstance(t){var e=Array.from(this._activeInstances).find(e=>{e=e._privateData.get(e);return e.elements.container&&e.elements.container.id===t});return e||(console.warn("âŒ No instance found with id: "+t),null)}_makeClickableElement(e){return e?(e._mgSelector=this._getElementSelector(e),e):null}_getElementSelector(e){return e.id?"#"+e.id:e.className?"."+e.className.split(" ").join("."):e.tagName.toLowerCase()}_isRgba(){let t=null;if(document.createElement){var e=document.createElement("p"),n=/^rgba/;if(e&&e.style&&"function"==typeof n.test)try{e.style.color="rgba(1, 1, 1, 0.5)",t=n.test(e.style.color)}catch(e){t=!1}}return t}_lazyload(e){e&&Array.from(e.querySelectorAll(".lazy")).forEach(e=>{var t=e.getAttribute("data-src");t&&e.setAttribute("src",t)})}_collectDebugInfo(){var e=Array.from(this._activeInstances).map((e,t)=>({id:t,instance:e}));return{total:e.length,instances:e}}_findInstanceByElement(e){"string"==typeof e&&(e=document.querySelector(e));for(var t of this._activeInstances){var n=t._privateData.get(t);if(n.elements.container===e||n.elements.container&&n.elements.container.contains(e)||n.elements.modal===e||n.elements.modal&&n.elements.modal.contains(e))return t}return null}_validateOptions(e){var t,n,s={};for([t,n]of Object.entries(e))t in c._defaultOptions&&(s[t]=n);return s}_createElement(e,t,n={}){let s=document.createElement(e);return t&&(s.className=t),Object.entries(n).forEach(([e,t])=>s.setAttribute(e,t)),s}_processContentIds(e,t="add"){if(e&&"string"!=typeof e){var n=e.getElementsByTagName("*"),s=c._config.prefixes.modal,i=this._privateData.get(this);for(let e=n.length;e--;){var o,a=n[e];a.id&&("add"===t?(i.originalIds.set(a,a.id),a.id=s+a.id):(o=i.originalIds.get(a))&&(a.id=o))}}}_createModalStructure(){var e=this._privateData.get(this),t=c._config;let n=t.classes.fadeIn+" "+t.classes.container;this._isRgba()&&(n=(this._isRgba()?"":"noRbga bg-legacy-opacity ")+n);var s=this._createElement("div",n+" "+this.options.className,{id:t.ids.container,role:"dialog","aria-modal":"true","aria-label":this.options.ariaLabel}),i=this._createElement("div",t.classes.modal+" "+this.options.className),o=(this.options.minWidth&&(i.style.minWidth=this.options.minWidth),this.options.maxWidth&&(i.style.maxWidth=this.options.maxWidth),this.options.position&&(i.style.marginTop=this.options.position),this._createElement("div",t.classes.content)),a=this._validateContent(this.options.content);let l;if("string"==typeof a)l=a;else try{this._processContentIds(a,"add"),l=a.innerHTML.replace(new RegExp(t.prefixes.modal,"gi"),"")}catch(e){console.warn("MG Modal: Failed to process HTMLElement content:",e),l="<div>Error loading modal content</div>"}o.innerHTML=l,i.appendChild(o),s.appendChild(i),this.options.closeButton&&(a=this._createElement("button",`ph-icon-cross ${t.classes.close} `+t.classes.button,{type:"button","aria-label":"Close modal"}),o.appendChild(a),e.elements.closeButton=a),e.elements.container=s,e.elements.modal=i,e.elements.contentHolder=o}_safeCallback(e,...t){if("function"==typeof e)try{e(...t)}catch(e){console.warn("MG Modal: Callback execution failed:",e)}}_validateContent(e){return e?"string"==typeof e&&""===e.trim()?(console.warn("MG Modal: Content contains only whitespace"),"<div>Modal content is empty</div>"):e:(console.warn("MG Modal: Content is empty or undefined"),"<div>Modal content is empty</div>")}_trapFocus(){var e=this._privateData.get(this),s=e.elements.container,i=s.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(0!==i.length){let t=i[0],n=i[i.length-1];i=e=>{"Tab"===e.key&&(e.shiftKey&&document.activeElement===t?(e.preventDefault(),n.focus()):e.shiftKey||document.activeElement!==n||(e.preventDefault(),t.focus()))};s.addEventListener("keydown",i),e.focusHandler=i,setTimeout(()=>t.focus(),100)}}_setupEventListeners(){let n=this._privateData.get(this),{container:s,closeButton:i}=n.elements;if(this.options.focusTrap&&this._trapFocus(),i){let e=s.querySelector("#"+this.options.flagCommentCancelClass),n=()=>{this.closeModal();var e=document.querySelector("form input.intendedAction"),t=document.querySelector("form input.userId");e&&t&&(e.value="",t.value=""),i.removeEventListener("click",n)};i.addEventListener("click",n),e&&e.addEventListener("click",n)}if(s&&this.options.closeDocument){let t=!1;n.elements.modal.addEventListener("mousedown",()=>{t=!0});s.addEventListener("click",e=>{e.target!==s||t||(getSelection().toString()||this.closeModal(),"undefined"!=typeof google&&google.accounts.id.cancel()),t=!1})}if(this.options.closeKey){let t=e=>{"Escape"===e.key&&n.isOpen&&(this.closeModal(),document.removeEventListener("keydown",t))};document.addEventListener("keydown",t)}this.options.pageScrolling&&(document.body.style.overflow="hidden")}_setupTimer(){this.options.timeMs&&(this._privateData.get(this).timer=setTimeout(()=>this.closeModal(),this.options.timeMs))}_cleanup(){var e=this._privateData.get(this),t=c._config;e.timer&&(clearTimeout(e.timer),e.timer=null),e.focusHandler&&e.elements.container&&(e.elements.container.removeEventListener("keydown",e.focusHandler),e.focusHandler=null),this.options.pageScrolling&&(document.body.style.overflow=""),this.options.content&&"string"!=typeof this.options.content&&this._processContentIds(this.options.content,"remove"),document.body.classList.remove(t.classes.open),document.documentElement.classList.remove(t.classes.open)}openModal(e){let t=this._privateData.get(this),n=c._config;var s;return t.isOpen||(this._createModalStructure(),this._setupEventListeners(),this._setupTimer(),s=t.elements.container,document.body.appendChild(s),document.body.classList.add(n.classes.open),document.documentElement.classList.add(n.classes.open),[t.elements.modal,s].forEach(e=>e.classList.add(n.classes.elementOpen)),this.options.overlay&&s.classList.add(n.classes.visible),this.options.lazyload&&this._lazyload(s),t.isOpen=!0,this._eventEmitter.dispatchEvent(new CustomEvent("modal:open",{detail:this})),this._safeCallback(e,s,t.elements.modal)),this}closeModal(t){let n=this._privateData.get(this),s=c._config;if(n.isOpen){let e=n.elements.container;e.classList.add(s.classes.fadeOut),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e),this._cleanup(),this.options.afterunload&&"function"==typeof this.options.afterunload&&this._safeCallback(this.options.afterunload,e,n.elements.modal),this._safeCallback(t,e,n.elements.modal)},300),n.isOpen=!1,this._eventEmitter.dispatchEvent(new CustomEvent("modal:close",{detail:this}))}return this}destroy(){this.closeModal(),this._activeInstances.delete(this),this._eventEmitter=null,this._privateData.delete(this)}isOpen(){var e=this._privateData.get(this);return e&&e.isOpen||!1}on(e,t){return this._eventEmitter.addEventListener(e,t),this}off(e,t){return this._eventEmitter.removeEventListener(e,t),this}static closeAll(){(c._activeInstances||new Set).forEach(e=>e.closeModal())}static getActiveCount(){return(c._activeInstances||new Set).size}}var e=function(e){return new c(e)};function n(){this._listeners={}}e.debug=function(){return console.clear(),(new c).debug()},e.inspect=function(e){return(new c).inspect(e)},e.stats=function(){return(new c).stats()},e.getInstance=function(e){return(new c).getInstance(e)},e.closeAll=function(){(c._activeInstances||new Set).forEach(e=>e.closeModal())},e.getActiveCount=function(){return(c._activeInstances||new Set).size},t.MGModal=c,t.MG_Modal=e,"undefined"!=typeof module&&module.exports&&(module.exports=c)}})("undefined"!=typeof window?window:this);