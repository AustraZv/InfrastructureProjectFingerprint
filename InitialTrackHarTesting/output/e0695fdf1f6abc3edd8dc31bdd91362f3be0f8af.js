class UserClogTracker{constructor(){if(UserClogTracker.instance)return UserClogTracker.instance;this.version="2.0.0",this.config={subdomainMap:{es:"spanish",jp:"japan",it:"italy",fr:"france"},debugMode:!1,maxRetries:3},this.currentContext="",this.requestQueue=[],this.isOnline=navigator.onLine,(UserClogTracker.instance=this).initEventListeners()}initEventListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.processQueue()}),window.addEventListener("offline",()=>{this.isOnline=!1})}track(e,i,t,r,n,a,s){var o=performance.now();try{this.validateRequiredParams(e,i);var u,d=this.buildTrackingData(i,t,r,n,a,s);this.isOnline?this.sendTracking(e,d):this.queueRequest(e,d),this.sendToGA4(d.ga4Obj),this.config.debugMode&&(u=performance.now()-o,console.log(`UserClogTracker: Event tracked in ${u.toFixed(2)}ms`,d))}catch(e){console.warn("UserClogTracking error:",e.message)}}updateContext(e){clickedElement=e,this.currentContext=e||""}validateRequiredParams(e,i){if(!e||"string"!=typeof e)throw new Error("currentDomain is required and must be a string");if(!i||"string"!=typeof i)throw new Error("eventType is required and must be a string")}buildTrackingData(e,i,t,r,n,a){var s={event:e},o=new URLSearchParams;return o.set("type","event"),o.set("event",e),this.addOriginData(o,s,{originPart:i,originUrl:t,itemId:r,originVariation:n}),this.addGeoData(o,s,e),this.addAdditionalParams(o,s,a),{urlParams:o,ga4Obj:s}}addOriginData(e,i,{originPart:t,originUrl:r,itemId:n,originVariation:a}){t&&(e.set("origin",t),i.origin=t),r&&(e.set("origin_url",r),i.origin_url=r),n&&(e.set("origin_item_id",n),i.origin_item_id=n),a&&(e.set("origin_item_variation",a),i.origin_item_variation=a)}addGeoData(e,i,t){t=this.getGeoLocalization(t);t&&(e.set("geo-localization",t),i["geo-localization"]=t)}getGeoLocalization(e){var i;return"undefined"==typeof page_params?null:(i=page_params["geo-localization"])&&"all"!==i?i:page_params.subdomain&&"signup-open"===e&&this.config.subdomainMap[page_params.subdomain]||null}addAdditionalParams(t,r,e){e&&"object"==typeof e&&Object.entries(e).forEach(([e,i])=>{e&&void 0!==i&&(t.set(e,i),r[e]=i)})}sendTracking(i,t,r=0){var n=i+"/_i?"+t.urlParams.toString(),e="undefined"!=typeof liuIdOrNull&&liuIdOrNull?{__m:liuIdOrNull}:{};if("undefined"!=typeof fetch)fetch(n,{method:"POST",headers:e,keepalive:!0}).then(e=>{!e.ok&&r<this.config.maxRetries&&setTimeout(()=>this.sendTracking(i,t,r+1),1e3*(r+1))}).catch(e=>{r<this.config.maxRetries?setTimeout(()=>this.sendTracking(i,t,r+1),1e3*(r+1)):console.warn("Tracking failed after retries:",e)});else{let e=new XMLHttpRequest;e.open("POST",n,!0),"undefined"!=typeof liuIdOrNull&&liuIdOrNull&&e.setRequestHeader("__m",liuIdOrNull),e.onload=()=>{400<=e.status&&r<this.config.maxRetries&&setTimeout(()=>this.sendTracking(i,t,r+1),1e3*(r+1))},e.onerror=()=>{r<this.config.maxRetries?setTimeout(()=>this.sendTracking(i,t,r+1),1e3*(r+1)):console.warn("Tracking failed after retries")},e.send()}}queueRequest(e,i){this.requestQueue.push({currentDomain:e,trackingData:i,timestamp:Date.now()}),100<this.requestQueue.length&&this.requestQueue.shift()}processQueue(){for(;0<this.requestQueue.length;){var e=this.requestQueue.shift();this.sendTracking(e.currentDomain,e.trackingData)}}sendToGA4(e){window.dataLayer&&"function"==typeof window.dataLayer.push&&window.dataLayer.push(e)}setDebugMode(e){this.config.debugMode=e}getVersion(){return this.version}}let userClogTracker=new UserClogTracker;function userClogTracking(e,i,t,r,n,a,s){userClogTracker.track(e,i,t,r,n,a,s)}function updateClogTracking(e){userClogTracker.updateContext(e)}