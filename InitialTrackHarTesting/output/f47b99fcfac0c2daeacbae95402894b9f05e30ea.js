function devLog(...e){!0===PURCHASE_PHX.isTestingMode&&console.log(...e)}function showErrorSnackbar(e){let t=document.querySelector(".js-pornhubXSnackbar.purchaseModalError");var a=t?.querySelector(".js-textPornhubXSnackbar"),s=t?.querySelector("div:first-child");t&&a?(a.textContent=e,s&&(s.className="js-closePornhubXSnackbar"),t.classList.remove("removeToastBar"),setTimeout(()=>{t.classList.add("removeToastBar")},8e3)):console.error("Snackbar element not found")}function handleApiError(e,t="Operation"){console.error(t+" failed:",e),console.error("Full error details:",{status:e.status,type:e.type,error:e.error,data:e.data}),e.data&&e.data.message?console.error("API Error Message:",e.data.message):e.data&&e.data.error?console.error("API Error:",e.data.error):e.error&&console.error("Error:",e.error),404===e.status?console.error("Endpoint not found (404)"):401===e.status||403===e.status?console.error("Authentication/Authorization failed"):500<=e.status?console.error("Server error"):"TypeError"===e.type&&console.error("Network/Connection error"),showErrorSnackbar(PURCHASE_PHX.txt.somethingWentWrong)}class StateManagerPHX{constructor(e){this._state={...e},this._listeners=new Map,this._trackers=new Map}getState(){return{...this._state}}setState(e){var t={...this._state};this._state={...this._state,...e},this._notifyListeners(t)}subscribe(e){let t=Symbol();return this._listeners.set(t,e),()=>this._listeners.delete(t)}_notifyListeners(e){for(var t of this._listeners.values())t(this._state,e)}trackStateProperty(a,s){if(a===s)throw new Error("Cannot track a property with the same name as the flag");var e=`${a}_${Date.now()}_`+Math.random().toString(36).substr(2,9),t=this.subscribe((e,t)=>{e[a]!==t[a]&&(t={[s]:!0,["last"+(a.charAt(0).toUpperCase()+a.slice(1))]:e[a]},this.setState(t))});return this._trackers.set(e,t),e}stopTracking(t,e){var a,s=[...this._trackers.keys()].find(e=>e.startsWith(t+"_"));return!!s&&((a=this._trackers.get(s))&&a(),this._trackers.delete(s),this.setState({[e]:!1}),!0)}logState(e){devLog(`%c${e}:`,"color: #4CAF50; font-weight: bold"),devLog(this._state)}destroy(){this._listeners.clear(),this._trackers.clear(),this._state={}}reinitialize(e){this._listeners.clear(),this._trackers.clear(),this._state={...e}}}function showGlobalLoader(e){e&&e.classList.remove("displayNone")}function hideGlobalLoader(e){e&&e.classList.add("displayNone")}async function fetchData(t,a={}){var e=document.querySelector(".js-phXpaymentLoader");showGlobalLoader(e);try{var s={method:"GET",headers:{"Content-Type":"application/json"},...a},o=await fetch(t,s);if(!o.ok)throw new Error("HTTP error! status: "+o.status);var r=o.headers.get("content-type");let e;return{success:!0,data:e=r&&r.includes("application/json")?await o.json():r&&r.includes("text")?await o.text():await o.blob(),status:o.status,headers:o.headers}}catch(e){return console.error("Fetch error:",e),{success:!1,error:e.message,type:e.name,status:e.status||null}}finally{hideGlobalLoader(e)}}class PornHubXPurchase{constructor(){this.subscriptions=[],this.purchaseInitialized=!1,this.initStateManager(),this.initElements(),this.initViewMoreLess(),this.initPlanSelection(),this.initCloseButtons(),this.initUpgradeButtons(),!0===PURCHASE_PHX.useReloadFlow||0<PURCHASE_PHX.txt.phxPaymentFailureMessage?.length?this.startNewReloadFlow():this.initializeFlow()}async initializeFlow(){try{await this.loadLibrary();var e,t=await this.getData();t.success?(devLog("Data received:",t.data),e=t.data.data||t.data,this.processData(e),this.fillPaymentMethodsModal(e),this.state.setState({isDataLoaded:!0}),this.showModal()):console.error("Failed to fetch data:",t.error)}catch(e){handleApiError({error:e.message},"Initialize purchase flow")}}async startNewReloadFlow(){devLog("Starting new reload flow...");try{var e,t,a,s,o=await this.getData();o.success?(devLog("Initial data received:",o.data),e=o.data.data||o.data,t=(this.processData(e),this.fillPaymentMethodsModal(e),PURCHASE_PHX.pricePackageUserSelected),a=(this.restoreSelectedPlan(t),this.updateStateFromSavedData(t),this.buildInitPurchasePayload()),(s=await this.sendInitRequest(a)).success&&s.data.mgpgResponse&&s.data.mgpgResponse.success?(devLog("Purchase initialized:",s.data),this.storeInitResponseData(s.data),this.initCommonJSLibrary(),this.checkCaptchaRender(),this.state.setState({isDataLoaded:!0}),this.modalContainer&&this.modalContainer.classList.remove("displayNone"),document.body.style.overflow="hidden",document.documentElement.classList.add("isOpenMTubes"),this.switchToModal2(),0<PURCHASE_PHX.txt.phxPaymentFailureMessage?.length&&("undefined"!=typeof emailVerificationModal&&emailVerificationModal.closeModal(),showErrorSnackbar(PURCHASE_PHX.txt.phxPaymentFailureMessage)),devLog("Reload flow completed successfully")):console.error("Failed to initialize purchase:",s.error)):console.error("Failed to fetch initial data:",o.error)}catch(e){console.error("Error starting new reload flow:",e),handleApiError({error:e.message},"Start new reload flow")}}loadLibrary(){return new Promise((e,t)=>{var a;window.CommonJSLibrary?(devLog("Probiller CommonJSLibrary already loaded"),e()):((a=document.createElement("script")).src="/lib/probiller.js",a.async=!0,a.onload=()=>{devLog("Probiller CommonJSLibrary loaded successfully"),e()},a.onerror=()=>{console.error("Failed to load Probiller library"),t(new Error("Failed to load Probiller library"))},document.head.appendChild(a))})}initStateManager(){this.state=new StateManagerPHX({selectedPlan:null,selectedPlanType:null,selectedCrypto:null,selectedCryptoCode:null,selectedCryptoName:null,cryptoSelectedFromList:!1,monthPlan:null,yearPlan:null,allPaymentMethods:[],allPrices:null,allPaymentTypes:[],selectedPaymentType:"cryptocurrency",selectedPaymentMethod:"cryptocurrency",currentModal:1,isDataLoaded:!1,purchaseInitData:null,paymentMethod:null,ats:null,showCreditCardModal:!1,mgpgBaseUri:null,mgpgInitEndpoint:null,mgpgFinalizeEndpoint:null,mgpgLogProcess:null,useProbillerMgpg:!1,isUserLoggedIn:!1,isUserLoggedInAfterSuccess:!1,eventFlags:{isBlackFridayPrelude:!1,isBlackFriday:!1,isCyberMonday:!1,isCyberMondayClosing:!1,valentines:!1},pricePackageId:0,mgpgValidationUrl:null,mgpgInitResponse:null,monitoringUUID:"",liuEmail:"",liuUsername:"",countryCode:PURCHASE_PHX.countryCode,isBrazil:"BR"===PURCHASE_PHX.countryCode,showPixOption:"BR"===PURCHASE_PHX.countryCode});var e=this.state.subscribe((e,t)=>{e.selectedPlan!==t.selectedPlan&&(devLog("Plan changed:",e.selectedPlan),this.updatePaymentModalSubtitle()),e.selectedCrypto!==t.selectedCrypto&&devLog("Crypto changed:",e.selectedCrypto)});this.subscriptions.push(e)}initElements(){if(this.modalContainer=document.getElementById("pornhubXPayment"),this.modal1=document.querySelector('[data-phxmodal-step="1"]'),this.modal2=document.querySelector('[data-phxmodal-step="2"]'),this.cryptoList=document.getElementById("cryptoList"),this.viewMoreBtn=document.getElementById("viewMoreBtn"),this.popularMethods=document.getElementById("popularMethods"),this.subTitleViewMore=document.getElementById("subTitleViewMore"),this.defaultActions=document.getElementById("defaultActions"),this.defaultBottomText=document.getElementById("defaultBottomText"),this.customDrawer=document.querySelector(".js-custom-drawer"),this.showLessBtn=this.cryptoList?.querySelector(".pornhubXPayment__paymentViewMoreBtn"),!this.modalContainer||!this.modal1)throw new Error("Required DOM elements not found - check HTML structure")}showModal(){this.modalContainer&&this.modalContainer.classList.remove("displayNone"),this.modal1&&(joinHitAtlas(),this.modal1.classList.remove("displayNone")),this.modal2&&this.modal2.classList.add("displayNone"),document.body.style.overflow="hidden",document.documentElement.classList.add("isOpenMTubes"),this.state.setState({currentModal:1})}initCloseButtons(){document.querySelectorAll(".js-phxModalbtnClose").forEach(e=>{e.addEventListener("click",()=>{var e=this.state.getState(),e=e.isUserLoggedInAfterSuccess;"undefined"!=typeof PURCHASE_PHX&&(PURCHASE_PHX.isPornhubXPurchaseFlowLogin=!1),this.hideModal(),e&&window.location.reload()})})}initUpgradeButtons(){let e=document.querySelector('[data-phxmodal-step="1"] .pornhubXPayment__upgradeBtn');e&&e.addEventListener("click",async()=>{if(!e.disabled){e.disabled=!0;try{await this.handleModal1Upgrade()}catch(e){console.error("Error during Modal 1 upgrade:",e)}finally{e.disabled=!1}}}),document.querySelectorAll('[data-phxmodal-step="2"] .pornhubXPayment__upgradeBtn').forEach(e=>{e.addEventListener("click",async()=>{if(!e.disabled){e.disabled=!0;try{await this.handleModal2Upgrade()}catch(e){console.error("Error during final purchase:",e)}finally{e.disabled=!1}}})}),document.querySelectorAll('[data-phxmodal-step="2"] .pornhubXPayment__backBtn').forEach(e=>{e.addEventListener("click",()=>{this.switchToModal1()})})}switchToModal1(){this.modal2&&this.modal2.classList.add("displayNone"),this.modal1&&this.modal1.classList.remove("displayNone");var e=this.state.getState();e.selectedPlanType&&this.updateModal1PlanSelection(e.selectedPlanType),this.updateModal1Pricing(),this.state.setState({currentModal:1})}updateModal1PlanSelection(e){var t=document.querySelector('[data-payment="month"]'),a=document.querySelector('[data-payment="year"]');t&&a&&("year"===e?(t.classList.remove("selected"),a.classList.add("selected")):(t.classList.add("selected"),a.classList.remove("selected")))}updateModal1Pricing(){var e=this.state.getState();e.monthPlan&&this.fillMonthPlan(e.monthPlan),e.yearPlan&&this.fillYearPlan(e.yearPlan,e.monthPlan);let t=e.selectedPaymentMethod;"cryptocurrency"===t?this.updateModal1PaymentDisplay(null):(e=e.allPaymentTypes?.find(e=>e.method===t),this.updateModal1PaymentDisplay(e||null))}hideModal(){this.modalContainer&&this.modalContainer.classList.add("displayNone"),this.modal2&&this.modal2.classList.add("displayNone"),this.modal1&&this.modal1.classList.remove("displayNone"),document.body.style.overflow="",document.documentElement.classList.remove("isOpenMTubes"),this.purchaseInitialized=!1,this.state.setState({currentModal:0})}async handleModal1Upgrade(){var e=this.state.getState();e.selectedPlan?(e.isUserLoggedIn?(devLog("User logged in - proceeding to payment selection"),this.switchToModal2(),1<e.allPaymentTypes.length&&this.initModal2PaymentTypeTabs()):(devLog("User not logged in - triggering login flow"),PURCHASE_PHX.isPornhubXPurchaseFlowLogin=!0,this.hideModal(),this.triggerLoginProcess()),devLog("Modal 1 upgrade handled successfully")):console.error("No plan selected")}populatePaymentMethodCards(e){let r=document.querySelector(".pornhubXPayment__paymentMethodCards");if(r){let o=this.state.getState();var t=r.querySelectorAll(".js-paymentMethodCard");devLog("Found payment method cards:",t.length),devLog("Current selectedPaymentMethod:",o.selectedPaymentMethod),devLog("Payment types to show:",e.map(e=>e.method)),t.forEach(e=>e.classList.add("displayNone")),e.forEach((e,t)=>{var a,s=r.querySelector(`[data-payment-method="${e.method}"]`);s?(s.classList.remove("displayNone"),(a=e.method===o.selectedPaymentMethod)?s.classList.add("selected"):s.classList.remove("selected"),devLog("Showing card:",e.method,"selected:",a)):devLog("Card not found for:",e.method)}),devLog("Payment method cards visibility updated:",e.length,"cards shown")}else devLog("ERROR: Payment method cards container not found")}initModal2PaymentTypeTabs(){var e=document.querySelector(".pornhubXPayment__paymentMethodCards"),t=document.querySelector("#subTitleViewMore");if(e){let o=this.state.getState();var a=null!=o.alternativePayment,s=1<o.allPaymentTypes?.length;if(devLog("Payment type tabs initialization:",{alternativePayment:o.alternativePayment,hasAlternativePayment:a,hasMultiplePaymentTypes:s,allPaymentTypes:o.allPaymentTypes}),a&&s){a=[...o.allPaymentTypes];o.cryptoPaymentMethods&&0<o.cryptoPaymentMethods.length&&(a.some(e=>"cryptocurrency"===e.method)||a.push({method:"cryptocurrency",type:"cryptocurrency"})),this.populatePaymentMethodCards(a),e.classList.remove("displayNone"),t&&t.classList.remove("displayNone");let s=document.querySelectorAll(".js-paymentMethodCard");s.forEach(a=>{a.addEventListener("click",()=>{let t=a.dataset.paymentMethod;var e=o.allPaymentTypes.find(e=>e.method===t)?.type||t;s.forEach(e=>e.classList.remove("selected")),a.classList.add("selected"),this.selectPaymentType(e,t),this.updateModal2ForPaymentType(e),"cryptocurrency"===t&&(this.expandCryptoSelection(),(e=this.state.getState()).selectedCryptoCode||(e=(e.cryptoPaymentMethods||[])[0])&&this.selectCrypto(e,!1,!1))})}),this.updateModal2ForPaymentType(o.selectedPaymentType),"cryptocurrency"!==o.selectedPaymentType&&(this.defaultActions&&this.defaultActions.classList.remove("displayNone"),this.defaultBottomText)&&this.defaultBottomText.classList.remove("displayNone"),this.initExpandCryptoButton(),devLog("Calling updatePaymentModalSubtitle from initModal2PaymentTypeTabs")}else t&&t.classList.remove("displayNone"),e.classList.add("displayNone");this.updatePaymentModalSubtitle()}}initExpandCryptoButton(){var e=document.getElementById("expandCryptoBtn");e&&e.addEventListener("click",()=>{devLog("Expand crypto button clicked"),this.expandCryptoSelection()})}expandCryptoSelection(){var e="desktop"===(this.modalContainer?.getAttribute("data-device")||"mobile"),t=this.state.getState(),a=null!=t.alternativePayment,t=1<t.allPaymentTypes?.length,s=(e&&this.modal2.classList.add("pornhubXPayment__modal--expanded"),this.cryptoList.classList.remove("displayNone"),this.viewMoreBtn.classList.add("displayNone"),this.popularMethods?.classList.add("displayNone"),this.subTitleViewMore?.classList.add("displayNone"),this.defaultActions?.classList.add("displayNone"),document.getElementById("cryptoSelectionRow")),s=(s&&s.classList.add("displayNone"),t&&(s=document.querySelector(".pornhubXPayment__paymentMethodCards"))&&s.classList.add("displayNone"),this.cryptoList.querySelector(".pornhubXPayment__subTitle--cryptoList"));s&&s.classList.remove("displayNone"),a&&t&&this.defaultBottomText?.classList.add("displayNone"),this.customDrawer?.classList.add("phX-custom-drawer"),e||(this.cryptoList.scrollTop=0)}async sendInitRequest(e){var t=this.state.getState().mgpgInitEndpoint;if(!t)throw new Error("Init endpoint not configured");e.token=window.token||"",devLog("Calling purchase init endpoint:",t),devLog("Init payload:",e);t=await fetchData(t,{method:"POST",body:JSON.stringify(e)});return t.success||handleApiError(t,"Purchase initialization"),t}async sendPurchaseData(e){devLog("Saving purchase data for logged-out user:",e);var t=PURCHASE_PHX.urls.postPackagePricePurchaseFlow;if(!t)throw new Error("SendData endpoint not configured");e.token=window.token||"";e={pricePackageUserSelected:e,token:token},devLog("Calling save purchase data endpoint:",t),devLog("Save payload:",e),t=await fetchData(t,{method:"POST",body:JSON.stringify(e)});if(t.success)return devLog("Purchase data saved successfully:",t.data),PURCHASE_PHX.purchaseFlowProcess=!0,t;throw handleApiError(t,"Send purchase data"),new Error("Failed to send purchase data")}updateStateFromSavedData(e){devLog("Updating state from saved data");var t={};e.monitoringUUID&&(t.monitoringUUID=e.monitoringUUID),e.userEmail&&(t.liuEmail=e.userEmail),e.username&&(t.liuUsername=e.username),e.geoCountry&&(t.countryCode=e.geoCountry),0<Object.keys(t).length&&(this.state.setState(t),devLog("State updated with saved data"))}restoreSelectedPlan(a){devLog("Restoring selected plan from saved data");a=a.products?.[0];if(a){var s=this.state.getState(),a=parseInt(a.initialDays);let e=null,t=null;365===a||2===a?(e=s.yearPlan,t="year"):30!==a&&1!==a||(e=s.monthPlan,t="month"),e?(this.state.setState({selectedPlan:e,selectedPlanType:t}),a=document.querySelector('[data-payment="year"]'),s=document.querySelector('[data-payment="month"]'),"year"===t&&a?(a.classList.add("selected"),s?.classList.remove("selected")):"month"===t&&s&&(s.classList.add("selected"),a?.classList.remove("selected"))):console.error("Could not match saved plan to available plans")}else devLog("No product data in saved purchase data")}storeInitResponseData(e){this.state.setState({purchaseInitData:e,mgpgValidationUrl:e.validationUrl,mgpgInitResponse:e.mgpgResponse,monitoringUUID:e.monitoringUUID||"",liuEmail:e.userEmail||"",liuUsername:e.username||e.userEmail||"",countryCode:PURCHASE_PHX.countryCode}),devLog("Stored init response data")}triggerLoginProcess(){"function"==typeof signinbox.show?(devLog("Start log in process"),joinSubmitAtlas(),PURCHASE_PHX.isPornhubXPurchaseFlowLogin=!0,signinbox.show({step:"signIn"})):devLog("Error to start log in process")}buildInitPurchasePayload(){var e=this.state.getState(),t=e.selectedPlan;if(t)return{paymentType:e.selectedPaymentType||"cryptocurrency",paymentMethod:e.selectedPaymentMethod||"cryptocurrency",currency:t.currency,products:[{quantity:1,description:"pornhubx",initialDays:t.initialDays.toString(),initialAmount:t.initialAmount.toString(),rebillingDays:t.rebillingDays.toString(),rebillingAmount:t.rebillingAmount.toString(),skuId:t.productSku,initialTotalAmount:t.initialTotalAmount.toString(),rebillingTotalAmount:t.rebillingTotalAmount.toString(),initialTaxAmount:t.initialTax.toString(),rebillingTaxAmount:t.rebillingTax.toString(),taxApplicationId:t.taxApplicationId,taxDisplayType:t.taxDisplayType.toString(),taxName:t.taxName,taxRate:t.taxRate.toString(),isTrial:Boolean(t.isTrial)}]};throw new Error("No plan selected")}initCommonJSLibrary(){this.probiller||(this.probiller=new window.CommonJSLibrary);var e=this.state.getState(),e={production:!1,initResponse:e.mgpgInitResponse,postBackUrls:{validation:e.mgpgValidationUrl,captcha:PURCHASE_PHX.urls.validateCaptcha},customEnv:{mgpgUrl:e.mgpgBaseUri},version:"v2",noRedirect:!0,captcha:{parameters:{sitekey:PURCHASE_PHX.gRecaptchaPublicKey||"",theme:"dark"},type:"v2"}};this.probiller.init(e),devLog("Probiller CommonJSLibrary initialized successfully")}checkCaptchaRender(){this.renderCaptchaAndWait(()=>{this.continuePurchase()})}switchToModal2(){gatewayHitAtlas(),this.modal1&&this.modal1.classList.add("displayNone"),this.modal2&&(document.getElementById("cryptoSelectionRow").classList.add("displayNone"),this.modal2.classList.remove("displayNone")),this.state.setState({currentModal:2}),this.loadRecaptchaScript();var e=this.state.getState();e.allPaymentTypes&&1<e.allPaymentTypes.length&&this.initModal2PaymentTypeTabs()}loadRecaptchaScript(){var e;"undefined"!=typeof grecaptcha?console.log("reCAPTCHA already loaded"):(console.log("Loading reCAPTCHA script for modal 2..."),(e=document.createElement("script")).src="https://www.google.com/recaptcha/enterprise.js?render=explicit",e.async=!0,e.defer=!0,e.onload=()=>{devLog("reCAPTCHA script loaded successfully")},e.onerror=()=>{console.error("Failed to load reCAPTCHA script")},document.head.appendChild(e))}async handleModal2Upgrade(){gatewaySubmitAtlas();var e=this.state.getState(),t=e.selectedPaymentType||"cryptocurrency",e=e.selectedPaymentMethod||"cryptocurrency";if(this.purchaseInitialized)devLog("Purchase already initialized, continuing..."),this.continuePurchase(t,e);else try{devLog("Initializing purchase...");var a=this.buildInitPurchasePayload(),s=await this.sendInitRequest(a);s.success&&s.data.mgpgResponse&&s.data.mgpgResponse.success?(devLog("Purchase initialized successfully:",s.data),this.storeInitResponseData(s.data),this.initCommonJSLibrary(),this.purchaseInitialized=!0,this.continuePurchase(t,e)):(console.error("Failed to initialize purchase:",s.error),showErrorSnackbar(PURCHASE_PHX.txt.somethingWentWrong||"Something went wrong, please try again."))}catch(e){console.error("Error initializing purchase:",e),showErrorSnackbar(PURCHASE_PHX.txt.somethingWentWrong||"Something went wrong, please try again.")}}renderCaptchaAndWait(a){setTimeout(()=>{var e=this.modal2.querySelector(".g-recaptcha"),t=!!e&&0<e.innerHTML.length;if(!t&&e)try{grecaptcha.enterprise.render(e,{sitekey:PURCHASE_PHX.gRecaptchaPublicKey||"",theme:"dark",callback:e=>{devLog("Captcha completed successfully"),this.probiller.setCaptchaToken(!0),a()},"expired-callback":()=>{devLog("Captcha expired"),this.probiller.setCaptchaToken(!1)}})}catch(e){console.warn("Captcha render error (possible duplicate):",e)}else t&&devLog("Captcha already rendered, waiting for user...")},500)}continuePurchase(a,s){var o=this.state.getState();if("cryptocurrency"!==a)devLog("Non-crypto payment type selected:",a),this.handleNonCryptoPayment();else if(o.selectedCrypto)if(this.probiller){devLog("Processing final crypto purchase...");var r="firstName",n="lastName",i=o.countryCode;let e={email:o.liuEmail,firstName:r,lastName:n,countryCode:i},t={paymentType:a,paymentMethod:s,paymentInformation:{user:{email:o.liuEmail,firstName:r,lastName:n,country:i,userName:o.liuUsername,password:"random"},cryptoCurrency:o.selectedCryptoCode}};setTimeout(()=>{this.executePurchaseRequest({payment:t,userInfo:e,callback:e=>{this.handlePurchaseResponse(e)}})},200)}else console.error("Probiller not initialized");else console.error("No cryptocurrency selected")}handleNonCryptoPayment(){var a=this.state.getState(),s=a.selectedPaymentType,o=a.selectedPaymentMethod;if(this.probiller){devLog("Processing non-crypto payment:",s,o);var r="firstName",n="lastName",i=a.countryCode;let e={email:a.liuEmail,firstName:r,lastName:n,countryCode:i},t={paymentType:s,paymentMethod:o,paymentInformation:{user:{email:a.liuEmail,firstName:r,lastName:n,country:i,userName:a.liuUsername,password:"random"}}};setTimeout(()=>{this.executePurchaseRequest({payment:t,userInfo:e,callback:e=>{this.handlePurchaseResponse(e)}})},200)}else console.error("Probiller not initialized")}executePurchaseRequest(a){a=a||{};var e={memberProfile:{username:this.state.getState().liuUsername||"user",password:"random"}},e=(a.payment&&(e.payment=a.payment),a.userInfo&&(e.member=a.userInfo),a.additionalParams&&Object.assign(e,a.additionalParams),this.logProcess("request"),this.probiller.process(e));console.warn(e),e.then(e=>{var t="undefined"!=typeof CommonJSData&&CommonJSData.validateResponse?Object.assign({},e,CommonJSData.validateResponse):e;"undefined"!=typeof CommonJSData&&CommonJSData.response?this.logProcess("response",Object.assign({},CommonJSData.response,CommonJSData.validateResponse||{})):this.logProcess("response",e),"function"==typeof e.redirect?(devLog("3DS authentication required - redirecting..."),e.redirect()):a.callback&&"function"==typeof a.callback&&a.callback(t)}).catch(e=>{console.error("Purchase processing error:",e)})}logProcess(t,a=null){var s=this.state.getState(),o=s.mgpgLogProcess;if(o){let e={email:s.liuEmail,geoCountry:s.countryCode};"response"===t&&a&&(e=Object.assign({},e,a));a={token:window.token||"",monitoringUuid:s.monitoringUUID||"",type:t,data:e};devLog("Logging process:",t,a),fetchData(o,{method:"POST",body:JSON.stringify(a)}).catch(e=>{console.error("Log error:",e)})}else devLog("Log endpoint not configured, skipping log")}handlePurchaseResponse(e){var t;devLog("Processing purchase response:",e),e.valid?devLog("Purchase successful!"):((t=this.modal2.querySelector(".paymentLoader"))&&t.classList.add("displayNone"),439==e.status||443==e.status?(showErrorSnackbar(PURCHASE_PHX.txt.completeCaptcha),this.checkCaptchaRender()):(console.error("Payment failed:",e.message||"Unknown error"),handleApiError(e,"Payment processing")))}detectAlternativePayment(e,t){var a,s={pix:PURCHASE_PHX.isPhxPixEnabled||!1,sepadirectdebit:PURCHASE_PHX.isPhxSepaEnabled||!1,ach:PURCHASE_PHX.isPhxAchEnabled||!1};if(e&&Array.isArray(e))for(var o of e)if("cryptocurrency"!==o.name)for(a of o.paymentMethods||[]){var r,n=a.name?.toLowerCase();if(s.hasOwnProperty(n)){if(s[n])return r={apiType:o.name,method:n,displayName:a.labelText||n.toUpperCase(),priceKey:n,logo:a.logo||n+".png",featureGateEnabled:!0},devLog("Alternative payment detected from API:",n,r),r;devLog("Alternative payment found but feature gate disabled:",n)}}return null}async getData(){var e=this.modalContainer?.getAttribute("data-callback-url")||"",e=await fetchData(PURCHASE_PHX.urls.initPurchaseFlowData,{method:"POST",body:JSON.stringify({urlName:e,isPornhubXPurchaseFlowLogin:!("undefined"!=typeof liuIdOrNull&&null!==liuIdOrNull)})});return e.success||handleApiError(e,"Load purchase data"),e}processData(e){devLog("Processing data:",e);this.state.getState();let t=this.detectAlternativePayment(e.paymentMethods?.paymentTypes,e.paymentMethod),a="cryptocurrency",s="cryptocurrency",o="cryptocurrency";t&&(a=t.apiType,s=t.method,o=e.prices?.[t.priceKey]?t.priceKey:"cryptocurrency",devLog("Alternative payment:",t.method,"Price key:",o));var r,n,i,l,d=e.prices?.[o];d?(r=d.find(e=>30===e.initialDays||1===e.initialDays),d=d.find(e=>365===e.initialDays||2===e.initialDays),r&&this.fillMonthPlan(r),d&&this.fillYearPlan(d,r),n=[],t&&n.push({type:t.apiType,method:t.method,name:t.displayName,priceKey:t.priceKey}),e.prices?.cryptocurrency&&n.push({type:"cryptocurrency",method:"cryptocurrency",name:"Crypto",priceKey:"cryptocurrency"}),i=(e.paymentMethods?.paymentTypes?.find(e=>"cryptocurrency"===e.name))?.paymentMethods||[],l=t&&e.paymentMethods?.paymentTypes?.find(e=>e.name===t.apiType)?.paymentMethods||[],devLog("Payment types extracted:",{defaultPaymentType:a,defaultPaymentMethod:s,alternativePayment:t,availablePaymentTypes:n,cryptoMethodsCount:i.length,alternativeMethodsCount:l.length}),devLog("Default payment method set:",{type:a,method:s,isAlternative:null!==t}),this.state.setState({selectedPlan:r,selectedPlanType:"month",monthPlan:r,yearPlan:d,allPrices:e.prices,allPaymentTypes:n,selectedPaymentType:a,selectedPaymentMethod:s,alternativePayment:t,paymentMethod:e.paymentMethod,ats:e.ats,showCreditCardModal:e.showCreditCardModal,mgpgBaseUri:e.mgpgBaseUri,mgpgInitEndpoint:e.mgpgPornhubXInitRequest,mgpgFinalizeEndpoint:e.mgpgPornhubXFinalizePurchase,mgpgLogProcess:e.mgpgLogProcess,useProbillerMgpg:e.useProbillerMgpg,isUserLoggedIn:e.isUserLoggedIn,cryptoPaymentMethods:i,alternativePaymentMethods:l,eventFlags:{isBlackFridayPrelude:e.eventIsBlackFridayPrelude,isBlackFriday:e.eventIsBlackFriday,isCyberMonday:e.eventIsCyberMonday,isCyberMondayClosing:e.eventIsCyberMondayClosing,valentines:e.valentines},pricePackageId:e.pricePackageId}),devLog("Endpoints configured:",{init:e.mgpgPornhubXInitRequest,finalize:e.mgpgPornhubXFinalizePurchase,log:e.mgpgLogProcess}),this.updateModal1PaymentDisplay(t)):console.error("No prices found for payment type:",o)}updateModal1PaymentDisplay(e){var t=document.querySelector('[data-payment-display="pix"]'),a=document.querySelector('[data-payment-display="sepadirectdebit"]'),s=document.querySelector('[data-payment-display="ach"]'),o=document.querySelector('[data-payment-display="cryptocurrency"]');t&&t.classList.add("displayNone"),a&&a.classList.add("displayNone"),s&&s.classList.add("displayNone"),o&&o.classList.add("displayNone"),e?(t=document.querySelector(`[data-payment-display="${e.method}"]`))?(t.classList.remove("displayNone"),devLog("Modal 1: Showing",e.method,"payment method")):(o&&o.classList.remove("displayNone"),devLog("Modal 1: Fallback to Cryptocurrency payment method")):(o&&o.classList.remove("displayNone"),devLog("Modal 1: Showing Cryptocurrency payment method"))}selectPaymentType(t,e){var a=this.state.getState(),s=a.allPrices;devLog("Selecting payment type:",t,e);let o="cryptocurrency";"cryptocurrency"!==t&&(r=a.allPaymentTypes?.find(e=>e.type===t))&&(o=s?.[r.priceKey]?r.priceKey:"cryptocurrency");var r=s?.[o];r?(devLog("Using price key:",o,"Prices:",r),s=r.find(e=>30===e.initialDays||1===e.initialDays),r=r.find(e=>365===e.initialDays||2===e.initialDays),s&&this.fillMonthPlan(s),r&&this.fillYearPlan(r,s),a=a.selectedPlanType||"month",this.state.setState({selectedPaymentType:t,selectedPaymentMethod:e,monthPlan:s,yearPlan:r,selectedPlan:"year"===a?r:s,selectedPlanType:a}),this.updateModal2ForPaymentType(t),this.updatePaymentModalSubtitle()):console.error("No prices found for payment type:",o)}updateModal2ForPaymentType(e){var t=document.querySelector(".pornhubXPayment__paymentMethodsPopular"),a=document.getElementById("viewMoreBtn"),s=document.getElementById("cryptoList"),o=document.querySelector(".pornhubXPayment__paymentMethodCards"),r=document.getElementById("cryptoSelectionRow"),n=document.getElementById("defaultBottomText"),i=document.getElementById("subTitleViewMore"),l=document.getElementById("defaultActions"),d=(devLog("Updating Modal 2 UI for payment type:",e),devLog("defaultActions found:",!!l),devLog("defaultBottomText found:",!!n),this.state.getState()),d=null!=d.alternativePayment;"cryptocurrency"===e?(this.state.setState({cryptoSelectedFromList:!1}),t&&t.classList.remove("displayNone"),d?this.popularMethods&&this.popularMethods.classList.add("displayNone"):(a&&a.classList.remove("displayNone"),this.popularMethods&&this.popularMethods.classList.remove("displayNone"))):(t&&t.classList.add("displayNone"),a&&a.classList.add("displayNone"),s&&s.classList.add("displayNone"),r&&r.classList.add("displayNone"),t&&t.classList.add("displayNone"),(e=document.querySelector(".js-custom-drawer"))&&e.classList.remove("phX-custom-drawer"),o&&i&&(i.after(o),o.classList.remove("displayNone")),(d=document.querySelector('.pornhubXPayment__paymentMethodCard[data-payment-method="cryptocurrency"]'))&&d.classList.remove("displayNone"),i&&i.classList.remove("displayNone"),n&&n.classList.remove("displayNone"),l&&l.classList.remove("displayNone"),this.modal2&&this.modal2.classList.remove("pornhubXPayment__modal--expanded"))}fillMonthPlan(e){var t,a=document.querySelector('[data-payment="month"]');a&&(t=a.querySelector(".pornhubXPayment__paymentFrequency"),a=a.querySelector(".pornhubXPayment__paymentCost"),t&&(t.textContent=e.displayData.upperText),a)&&(a.textContent=e.displayData.displayPrice)}fillYearPlan(e,t){var a,s,o=document.querySelector('[data-payment="year"]');o&&(a=o.querySelector(".pornhubXPayment__paymentFrequency"),s=o.querySelector(".pornhubXPayment__paymentCost"),o=o.querySelector(".pornhubXPayment__paymentDiscount"),a&&(a.textContent=e.displayData.upperText),s&&(s.textContent=e.displayData.displayPrice),o)&&t&&0<(s=(((a=t.initialAmount)-e.initialAmount/12)/a*100).toFixed(1))&&(o.textContent=s+"% OFF")}initPlanSelection(){let t=document.querySelector('[data-payment="month"]'),a=document.querySelector('[data-payment="year"]');t&&t.addEventListener("click",()=>{t.classList.add("selected"),a?.classList.remove("selected");var e=this.state.getState();this.state.setState({selectedPlan:e.monthPlan,selectedPlanType:"month"}),this.updatePaymentModalSubtitle()}),a&&a.addEventListener("click",()=>{a.classList.add("selected"),t?.classList.remove("selected");var e=this.state.getState();this.state.setState({selectedPlan:e.yearPlan,selectedPlanType:"year"}),this.updatePaymentModalSubtitle()})}updatePaymentModalSubtitle(){var e=this.state.getState();if(e.selectedPlan){var a=document.querySelectorAll('[data-phxmodal-step="2"] .pornhubXPayment__subTitle--cryptoList'),s=e.selectedPlan,o=s.displayData?.displayPrice||"",s=s.initialDays||30;let t=`Membership to Pornhub X - ${s} days for a charge of `+o;devLog("updatePaymentModalSubtitle:",{selectedPlanType:e.selectedPlanType,initialDays:s,displayPrice:o,generatedSubtitle:t,subtitleElements:a.length}),a.forEach(e=>{e.textContent=t})}else devLog("updatePaymentModalSubtitle: No selected plan found")}fillPaymentMethodsModal(e){var t,a;e.paymentMethods?.paymentTypes?(t=e.paymentMethods.paymentTypes.find(e=>"cryptocurrency"===e.name)?.paymentMethods||[],a=(e=e.paymentMethods.paymentTypes.find(e=>"banktransfer"===e.name)?.paymentMethods||[]).filter(e=>"pix"===e.name),devLog("Payment methods found:",{crypto:t.length,banktransfer:e.length,pix:a.length}),this.state.setState({allPaymentMethods:t,pixPaymentMethods:a,cryptoPaymentMethods:t}),0<t.length&&(this.fillPopularMethods(t),this.fillCryptoList(t),"cryptocurrency"===this.state.getState().selectedPaymentType)&&(e=t[0])&&this.selectCrypto(e,!1,!1),this.updatePaymentModalSubtitle()):console.error("No payment types found")}fillPopularMethods(e){let a=document.getElementById("popularMethods");a&&(a.innerHTML="",e.slice(0,2).forEach((e,t)=>{t=this.createCryptoCard(e,0===t);a.appendChild(t),this.attachCryptoCardListener(t.querySelector?t:t.firstElementChild,e)}))}fillCryptoList(e){let a=document.querySelector("#cryptoList .pornhubXPayment__cryptoList");a&&(a.innerHTML="",e.forEach((e,t)=>{t=this.createCryptoCard(e,0===t);a.appendChild(t),this.attachCryptoCardListener(t.querySelector?t:t.firstElementChild,e),t.addEventListener("click",()=>{this.updatePopularMethods(e),this.onViewLessElemsToHide()})}))}attachCryptoCardListener(e,t){e&&(e=e.classList.contains("pornhubXPayment__cryptoCurrencyCard")?e:e.querySelector(".pornhubXPayment__cryptoCurrencyCard"))&&e.addEventListener("click",()=>{this.selectCrypto(t)})}selectCrypto(e,t=!0,a=!0,s=!0){document.querySelectorAll(".pornhubXPayment__cryptoCurrencyCard").forEach(e=>{e.classList.remove("selected")});document.querySelectorAll(`[data-crypto-code="${e.code}"]`).forEach(e=>{e.classList.add("selected")});var o=this.state.getState(),r=null!=o.selectedCryptoCode,o=(this.state.setState({selectedCrypto:e,selectedCryptoCode:e.code,selectedCryptoName:e.name,cryptoSelectedFromList:o.cryptoSelectedFromList||s&&r}),this.updatePaymentModalSubtitle(),this.updatePopularMethods(e),a&&this.updateSelectedCryptoCard(e),this.state.getState());t&&1<o.allPaymentTypes?.length&&this.collapseCryptoSelection(),devLog("Selected cryptocurrency:",e.code)}updateSelectedCryptoCard(e){var t=document.getElementById("cryptoSelectionRow"),a=document.getElementById("selectedCryptoIcon"),s=document.getElementById("selectedCryptoCard");t&&a&&(a.src=e.logo,a.alt=e.name,s&&s.classList.add("selected"),t.classList.remove("displayNone"),devLog("Updated selected crypto card:",e.code))}collapseCryptoSelection(){this.onViewLessElemsToHide();var e=document.querySelector('.pornhubXPayment__paymentMethodCard[data-payment-method="cryptocurrency"]'),e=(e&&e.classList.add("displayNone"),document.getElementById("cryptoSelectionRow"));e&&e.classList.remove("displayNone"),devLog("Collapsed crypto selection")}updatePopularMethods(a){let s=document.getElementById("popularMethods");if(s){var e=this.state.getState().allPaymentMethods;if(e&&0!==e.length){s.innerHTML="";let t=[a];e.forEach(e=>{e.code!==a.code&&t.length<2&&t.push(e)}),t.slice(0,2).forEach((e,t)=>{t=this.createCryptoCard(e,0===t);s.appendChild(t),this.attachCryptoCardListener(t.querySelector?t:t.firstElementChild,e)})}}}createCryptoCard(e,t=!1){var a,s=document.getElementById("cryptoCardTemplate");return s?(s=s.content.cloneNode(!0).querySelector(".pornhubXPayment__cryptoCurrencyCard"),t&&s.classList.add("selected"),s.dataset.cryptoCode=e.code,s.dataset.cryptoName=e.name,(a=s.querySelector(".crypto-logo"))&&(a.src=e.logo,a.alt=e.name),s):this.createCryptoCardFallback(e,t)}createCryptoCardFallback(e,t=!1){var a=document.createElement("div"),t=(a.className="pornhubXPayment__cryptoCurrencyCard"+(t?" selected":""),a.dataset.cryptoCode=e.code,a.dataset.cryptoName=e.name,document.createElement("div")),s=(t.className="pornhubXPayment__cryptoCurrencyLogo",document.createElement("img"));return s.className="crypto-logo",s.src=e.logo,s.alt=e.name,t.appendChild(s),a.appendChild(t),a}initViewMoreLess(){this.viewMoreBtn&&this.showLessBtn?(this.viewMoreBtn.addEventListener("click",()=>{var e="desktop"===(this.modalContainer?.getAttribute("data-device")||"mobile");e&&this.modal2.classList.add("pornhubXPayment__modal--expanded"),this.cryptoList.classList.remove("displayNone"),this.viewMoreBtn.classList.add("displayNone"),this.popularMethods?.classList.add("displayNone"),this.subTitleViewMore?.classList.add("displayNone"),this.defaultActions?.classList.add("displayNone"),this.defaultBottomText?.classList.add("displayNone"),this.customDrawer?.classList.add("phX-custom-drawer"),e||(this.cryptoList.scrollTop=0)}),this.showLessBtn.addEventListener("click",()=>{this.onViewLessElemsToHide()})):console.warn("View more/less buttons not found")}onViewLessElemsToHide(){this.modal2.classList.remove("pornhubXPayment__modal--expanded"),this.cryptoList.classList.add("displayNone");var e=this.state.getState(),t=(null!=e.alternativePayment?this.popularMethods?.classList.add("displayNone"):(this.popularMethods?.classList.remove("displayNone"),this.viewMoreBtn.classList.remove("displayNone")),document.getElementById("cryptoSelectionRow")),a=e.cryptoSelectedFromList,a=(t&&a?t.classList.remove("displayNone"):t&&t.classList.add("displayNone"),document.querySelector(".pornhubXPayment__paymentMethodCards")),t=document.getElementById("subTitleViewMore");a&&t&&(t.after(a),1<e.allPaymentTypes?.length)&&a.classList.remove("displayNone"),this.subTitleViewMore?.classList.remove("displayNone"),this.defaultActions?.classList.remove("displayNone"),this.defaultBottomText?.classList.remove("displayNone"),this.customDrawer?.classList.remove("phX-custom-drawer")}getCheckoutData(){var e=this.state.getState();return{plan:{type:e.selectedPlanType,days:e.selectedPlan?.initialDays,amount:e.selectedPlan?.initialAmount,currency:e.selectedPlan?.currency,displayPrice:e.selectedPlan?.displayData?.displayPrice,productSku:e.selectedPlan?.productSku,packageSku:e.selectedPlan?.packageSku},crypto:{code:e.selectedCryptoCode,name:e.selectedCryptoName,fullData:e.selectedCrypto}}}logCurrentState(){this.state.logState("Current Purchase State")}destroy(){this.subscriptions.forEach(e=>e()),this.subscriptions=[],this.state&&this.state.destroy(),this.probiller&&(this.probiller=null),devLog("PornHubXPurchase instance destroyed successfully")}async resumePurchaseAfterLogin(){devLog("Resuming purchase flow after login..."),this.state.setState({isUserLoggedIn:!0,isUserLoggedInAfterSuccess:!0}),PURCHASE_PHX.isPornhubXPurchaseFlowLogin=!1,this.modalContainer&&this.modalContainer.classList.remove("displayNone"),document.body.style.overflow="hidden",document.documentElement.classList.add("isOpenMTubes"),this.switchToModal2(),this.state.setState({cryptoSelectedFromList:!1})}}function joinHitAtlas(){if("object"==typeof atlas)try{atlas.joinHit()}catch(e){console.error("Atlas joinHit error:",e)}}function joinSubmitAtlas(){if("object"==typeof atlas)try{atlas.joinSubmit()}catch(e){console.error("Atlas joinSubmit error:",e)}}function gatewaySubmitAtlas(){if("object"==typeof atlas)try{atlas.joinGatewaySubmit()}catch(e){console.error("Atlas joinGatewaySubmit error:",e)}}function gatewayHitAtlas(){if("object"==typeof atlas)try{atlas.joinGatewayHit()}catch(e){console.error("Atlas joinGatewayHit error:",e)}}function detectAtlasRealEstate(e){var e=e.closest(".adsRemoveButtonWrapper"),t="desktop"===(e?.getAttribute("data-device")||"mobile")?"desktop":"mobile",a=e?.getAttribute("data-origin-page")||"other";let s="cta_footer";e&&(o=e.classList,Array.from(o).join(" "),o.contains("prerollAd")?s="cta_preroll":o.contains("topRemoveCTA")||o.contains("main_top_right")||o.contains("video_top_right")||e.closest("#playerWrapper")||e.closest(".topAdContainer")?s="cta_header":o.contains("middleRemoveCTA")||e.closest(".middleAdContainer")?s="cta_middle":(o.contains("bottomRemoveCTA")||o.contains("bottom")||e.closest(".bottomAdContainer")||e.closest(".pre-footer"))&&(s="cta_footer"));var o=`phx:${t}:${a}:`+s;return console.log("Detected Atlas Real Estate:",o),o}function initializeAtlasTracking(e){if("object"!=typeof atlas)return devLog("Atlas not available"),!1;try{return atlas.init({affUrl:"pornhub.com",networkCode:"PHX",defaultCode:"eyJhIjo5NDk2LCJjIjoyMTk3MywibiI6MTUxLCJzIjo3OTQsImUiOjExMzA4LCJwIjozfQ",autoTrack:!0,usePrimaryDomainForEtahub:!PURCHASE_PHX.isTestingMode,debug:PURCHASE_PHX.isTestingMode,onlyEssentialCookies:PURCHASE_PHX.isOnlyEssentialCookies,realEstate:e||null}),devLog("Atlas initialized successfully"),!0}catch(e){return console.error("Atlas initialization error:",e),!1}}(()=>{var e=document.querySelectorAll(".js-adsRemoveButton");if("undefined"!=typeof PURCHASE_PHX&&document.getElementById("pornhubXPayment")&&(!0===PURCHASE_PHX.useReloadFlow||0<PURCHASE_PHX.txt.phxPaymentFailureMessage?.length))try{var t=new PornHubXPurchase;window.pornhubXPurchase=t}catch(e){devLog("Error initializing with reload flow:",e)}0<e.length&&e.forEach(a=>{a.addEventListener("click",async()=>{if(!a.disabled)if("undefined"!=typeof PURCHASE_PHX&&document.getElementById("pornhubXPayment")){a.disabled=!0;try{var e=detectAtlasRealEstate(a),t=new PornHubXPurchase;window.pornhubXPurchase=t,initializeAtlasTracking(e)}catch(e){console.error("Error while creating class instance:",e)}finally{setTimeout(()=>{a.disabled=!1},2e3)}}else devLog("PornhubX purchase modal not available")})}),window.postUserStateInPurchaseFlow=async function(){try{var e=PURCHASE_PHX.urls.postUserStateInPurchaseFlow,t={token:window.token,isPornhubXPurchaseFlowLogin:!0},a=(devLog("Calling saveUserStateInPurchaseFlow endpoint:",e),devLog("Payload:",t),await fetchData(e,{method:"POST",body:JSON.stringify(t)}));return a.success?(devLog("User state saved successfully:",a.data),!0):(console.error("Failed to save user state:",a.error),handleApiError(a,"Save user state in purchase flow"),!1)}catch(e){return console.error("Error saving user state:",e),handleApiError({error:e.message},"Save user state in purchase flow"),!1}}})();