var playlistsUtils=(()=>{function s(e){var l=document.querySelector(".errorMessage");l&&MG_Utils.hasClass(l,"displayNone")&&void 0!==e&&(l.innerText=e,MG_Utils.removeClass(l,"displayNone"),setTimeout(function(){MG_Utils.addClass(l,"displayNone")},5e3))}function u(e,l){var t,a,s,i=document.createElement("div"),d=document.getElementById("playlist-form"),r=document.querySelector("#modalWrapMTubes .playlist-modal");d&&MG_Utils.addClass(d,"displayNone"),i.className="succesMsg",r&&(d=r.querySelector(".modal-title"),t=r.querySelector(".succesMsg"),a="",s=e.code==WIDGET_PLAYLIST_HEADER.videoNotActiveCode?WIDGET_PLAYLIST_HEADER.videoNotAdded:e.message??"",d&&(d.innerHTML=s),e.success?(d&&(d.innerHTML=WIDGET_PLAYLIST_HEADER.successNewPlaylist+"!",MG_Utils.addClass(d,"successGreen")),a=WIDGET_PLAYLIST_HEADER.successVideoAdded+": "+l):(d&&MG_Utils.addClass(d,"failureRed"),e.code!=WIDGET_PLAYLIST_HEADER.videoNotActiveCode&&(a=l+" "+(e.message??""))),t?MG_Utils.setText(t,a):(MG_Utils.setText(i,a),r.appendChild(i)),setTimeout(function(){location.reload()},3e3))}function o({type:e="POST",url:l,data:t={},dataType:a="json",cache:s=!1,headers:i={},success:d}){let r;i["Cache-Control"]=s?"cache":"no-cache","json"===a?(i["Content-Type"]="application/json",r=JSON.stringify(t)):"form"===a&&(i["Content-Type"]="application/x-www-form-urlencoded",r=new URLSearchParams(t).toString()),fetch(l,{method:e,headers:i,body:"GET"===e?void 0:r,credentials:"same-origin"}).then(e=>{if(e.ok)return e.json();throw new Error("HTTP error! Status: "+e.status)}).then(e=>{d&&d(e)}).catch(e=>console.error("Fetch error:",e))}return{copyPlaylist:function(s,e,l,t,i,d,r){playlistCreateUrl&&o({type:"POST",url:playlistCreateUrl,dataType:"json",data:{title:s,tags:e.split("|"),description:l,status:t,token:i},headers:"undefined"!=typeof liuIdOrNull&&liuIdOrNull?{__m:liuIdOrNull}:{},success:function(e){var l,t,a;e.id&&d?(t={},e.id&&(t.pid=e.id),r&&(t.vid=r),i&&(t.token=i),l=d,a=s,(t=t)&&MG_Utils.ajaxCall({type:"POST",url:l,data:t,dataType:"json",headers:"undefined"!=typeof liuIdOrNull&&liuIdOrNull?{__m:liuIdOrNull}:{},success:function(e){u(e,a)}})):e&&u(e,s)}})},createPlaylist:function(l,e,t,a,s,i,d){playlistCreateUrl&&MG_Utils.ajaxCall({type:"POST",url:playlistCreateUrl,requestType:"application/json",headers:"undefined"!=typeof liuIdOrNull&&liuIdOrNull?{__m:liuIdOrNull}:{},data:{title:l,tags:e.split("|"),description:t,status:a,token:token,vid:Number(s)},success:function(e){if(e.success)u(e,l),d&&d.removeAttribute("disabled");else{let l="";void(e&&(e.forEach(function(e){l=e.field+`: ${e.message} <br>`}),i&&l&&(i.innerHTML=l,MG_Utils.removeClass(i,"displayNone")),d&&d.removeAttribute("disabled"),d)&&MG_Utils.removeClass(d,"hasSubmitted"))}},error:function(e){let l="";e&&(e.forEach(function(e){l=e.field+`: ${e.message} <br>`}),i&&l&&(i.innerHTML=l,MG_Utils.removeClass(i,"displayNone")),d&&d.removeAttribute("disabled"),d)&&MG_Utils.removeClass(d,"hasSubmitted")}})},addVideoToPlaylist:function(e,l,t,a,s,i){var d="watchlater"===s?playlistWatchlaterAddUrl:playlistCustomAddUrl,r={};e&&(r.pid=e),l&&(r.vid=l),t&&(r.token=t),d&&MG_Utils.ajaxCall({url:d,type:"POST",requestType:"application/json",data:r,headers:"undefined"!=typeof liuIdOrNull&&liuIdOrNull?{__m:liuIdOrNull}:{},success:function(e){var l=a&&a.parentNode,t=a&&a.querySelector("span");i?"function"==typeof i&&i(e):a&&(l&&MG_Utils.addClass(l,"added"),"watchlater"===s?(e=document.createElement("span"),l&&l.appendChild(e),e&&(e.textContent=TRANSLATED_MESSAGE.added)):t&&(t.textContent=TRANSLATED_MESSAGE.added))},error:function(e){var l=a&&a.parentNode,t=a&&a.querySelector("span");"Already added!"===e.message?(l&&MG_Utils.addClass(l,"alreadyAdded"),"watchlater"===s?l.querySelector("span")||(spanItem=document.createElement("span"),l&&l.appendChild(spanItem),spanItem&&(spanItem.textContent=TRANSLATED_MESSAGE.alreadyAdded+"!")):t&&(t.textContent=TRANSLATED_MESSAGE.alreadyAdded+"!")):e.message&&(t=l&&l.querySelector(".alreadyInPlaylistMessage"))&&(t.innerText=e.message,MG_Utils.addClass(t,"requestErrorMessage"))}})},addToFavourites:function(e,l,t){playlistFavouriteAddUrl&&MG_Utils.ajaxCall({type:"POST",url:playlistFavouriteAddUrl,requestType:"application/json",data:{pid:Number(e),token:l},headers:"undefined"!=typeof liuIdOrNull&&liuIdOrNull?{__m:liuIdOrNull}:{},success:function(e){t&&(MG_Utils.addClass(t,"favorited"),t.setAttribute("data-title",WIDGET_PLAYLIST_HEADER.alreadyInFavorite))},error:function(e){s(e.message)}})},removeFromFavourites:function(e,l,t,a){playlistFavouriteRemoveUrl&&MG_Utils.ajaxCall({type:"DELETE",url:playlistFavouriteRemoveUrl,headers:"undefined"!=typeof liuIdOrNull&&liuIdOrNull?{__m:liuIdOrNull}:{},success:function(e){var l;t&&(MG_Utils.removeClass(t,"favorited"),t.setAttribute("data-title",WIDGET_PLAYLIST_HEADER.favoritePL)),a&&(l=document.getElementById(a))&&l.parentNode.removeChild(l)},error:function(e){s(e.message)}})},updatePlaylist:function(e,l){var t=!(!e||!e.id)&&e.id,t=t&&"watchlater"==t&&playlistUpdateUrlWatchlater?playlistUpdateUrlWatchlater:playlistUpdateUrl;t&&o({type:"PUT",url:t,dataType:"json",data:e,headers:"undefined"!=typeof liuIdOrNull&&liuIdOrNull?{__m:liuIdOrNull}:{},success:function(e){l&&l(e)}})},deleteAllFromPlaylist:function(e,l,t,a){removeAllVideosFromPlaylist&&o({type:"DELETE",url:t||removeAllVideosFromPlaylist,dataType:"json",data:{pid:e,token:l},headers:"undefined"!=typeof liuIdOrNull&&liuIdOrNull?{__m:liuIdOrNull}:{},success:function(e){a()}})},deletePlaylist:function(){playlistDeleteUrl&&MG_Utils.ajaxCall({type:"DELETE",url:playlistDeleteUrl,headers:"undefined"!=typeof liuIdOrNull&&liuIdOrNull?{__m:liuIdOrNull}:{},success:function(e){window.location.href=myPlaylistUrl}})},removeVideoFromPlaylist:function(e,l,t){MG_Utils.ajaxCall({type:"DELETE",url:playlistActionBaseUrl+e+"/video_remove/"+l+"?token="+t,headers:"undefined"!=typeof liuIdOrNull&&liuIdOrNull?{__m:liuIdOrNull}:{}})},removeVideoFromWatchlater:function(e,l){MG_Utils.ajaxCall({type:"DELETE",url:playlistActionBaseUrl+"video_remove_watchlater?token="+l+"&vid="+e,headers:"undefined"!=typeof liuIdOrNull&&liuIdOrNull?{__m:liuIdOrNull}:{}})},playlistRate:function(e,l,t){var a;playlistRateUrl&&(a={token:token,pid:Number(e.pid),value:Boolean(e.value)},e.current&&(a.current=e.current),MG_Utils.ajaxCall({type:"POST",url:playlistRateUrl,requestType:"application/json",data:a,headers:"undefined"!=typeof liuIdOrNull&&liuIdOrNull?{__m:liuIdOrNull}:{},success:function(e){e&&void 0!==l&&l&&(e={id:e.id,value:t?-1:Number(e.value)},LocalStorageManager.getInstance().push("playlistRated",e))}}))},loadVideos:function(e,l,t,a,s){e&&MG_Utils.ajaxGetData({url:e+"&offset="+(a+l*t)+"&itemsPerPage="+t,method:"get",success:function(e){s&&s(e)}})},lazyLoadVideos:function(e,l,t){e&&MG_Utils.ajaxCall({url:e+"&page="+l,type:"GET",dataType:"text",headers:"undefined"!=typeof liuIdOrNull&&liuIdOrNull?{__m:liuIdOrNull}:{},success:function(e){t&&t(e),(new LazyLoadImage).init(page_params.lazyLoad)}})},savePlaylist:function(e,l,t){e&&MG_Utils.ajaxCall({url:e,data:l,type:"POST",headers:"undefined"!=typeof liuIdOrNull&&liuIdOrNull?{__m:liuIdOrNull}:{},success:function(e){t&&t(e)}})}}})();